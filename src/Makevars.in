#################################################################

### SEXPtools
SEXPTOOLS_CPPFLAGS = @SEXPTOOLS_CPPFLAGS@
SEXPTOOLS_LDFLAGS = @SEXPTOOLS_LDFLAGS@


### Package flags.
PKG_CPPFLAGS = $(SEXPTOOLS_CPPFLAGS) -Wfatal-errors
PKG_CFLAGS = $(SHLIB_OPENMP_CFLAGS) -w
PKG_FCFLAGS = $(SHLIB_OPENMP_FCFLAGS) -Wimplicit-interface #-w
#PKG_FCFLAGS = $(SAFE_FCFLAGS) $(SHLIB_OPENMP_FCFLAGS) -w -Wfatal-errors


### FIXME
PKG_LIBS = $(FLIBS) $(SEXPTOOLS_LDFLAGS) $(SHLIB_OPENMP_CFLAGS) -llapack


### Setup R source code and objects.

GLM = \
		linmod/src/glm/glm_check.o \
		linmod/src/glm/glm_link_utils.o \
		linmod/src/glm/glm_loglik_utils.o \
		linmod/src/glm/glm_mu_var.o \
		linmod/src/glm/glm_residuals_utils.o \
		linmod/src/glm/glm_update_utils.o \
		linmod/src/glm/glm.o 


CINTERFACE = \
		linmod/src/c_interface/lm_fit.o


LAPACK = \
		linmod/src/lapack/dgeadd_omp.o \
		linmod/src/lapack/dlacpy.o \
		linmod/src/lapack/lapack.o \
		linmod/src/lapack/lapack_omp.o


LM = \
		linmod/src/lm/lmfit.o \
		linmod/src/lm/rdgels.o \
		linmod/src/lm/rdgeqpf.o \
		linmod/src/lm/rdormqr.o


UTILS = \
		linmod/src/utils/string_tools.o


R_OBJS = glm_fit.o lm_fit.o



OBJECTS = $(UTILS) $(LAPACK) $(LM) $(GLM) $(CINTERFACE) $(R_OBJS) 




### Start making here.
all: $(SHLIB)


# Fortran module dependencies
linmod/src/lm/rdgels.o: \
		linmod/src/lapack/lapack_omp.o

linmod/src/lapack/dlacpy.o: \
		linmod/src/utils/string_tools.o

linmod/src/glm/glm_loglik_utils.o: \
		linmod/src/glm/glm_link_utils.o

linmod/src/glm/glm_update_utils.o: \
		linmod/src/lapack/lapack.o \
		linmod/src/lm/lmfit.o

linmod/src/glm_mu_var.o: \
		linmod/src/lapack/lapack.o

linmod/src/glm.o: \
		linmod/src/lapack/lapack.o \
		linmod/src/glm/glm_check.o \
		linmod/src/glm/glm_link_utils.o \
		linmod/src/glm/glm_loglik_utils.o \
		linmod/src/glm/glm_mu_var.o \
		linmod/src/glm/glm_residuals_utils.o
		linmod/src/glm/glm_update_utils.o


$(SHLIB): $(OBJECTS)


clean:
	@rm -rf *.o *.mod *.d *.rc *.so *.dylib *.dll *.a *.lib \
		Makedeps Makevars $(SHLIB) $(OBJECTS) \
		linmod/src/*.o 
